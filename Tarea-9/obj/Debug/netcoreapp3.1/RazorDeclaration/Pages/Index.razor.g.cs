// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace Tarea_9.Pages
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "C:\Users\dhima\Tarea-9\Tarea-9\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\dhima\Tarea-9\Tarea-9\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\dhima\Tarea-9\Tarea-9\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\dhima\Tarea-9\Tarea-9\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\dhima\Tarea-9\Tarea-9\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\Users\dhima\Tarea-9\Tarea-9\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "C:\Users\dhima\Tarea-9\Tarea-9\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "C:\Users\dhima\Tarea-9\Tarea-9\_Imports.razor"
using Tarea_9;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "C:\Users\dhima\Tarea-9\Tarea-9\_Imports.razor"
using Tarea_9.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\dhima\Tarea-9\Tarea-9\Pages\Index.razor"
using Models;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\dhima\Tarea-9\Tarea-9\Pages\Index.razor"
using System.Net.Mail;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\dhima\Tarea-9\Tarea-9\Pages\Index.razor"
using System.Text.RegularExpressions;

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/")]
    public partial class Index : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 77 "C:\Users\dhima\Tarea-9\Tarea-9\Pages\Index.razor"
      

    private string Menssage{get;set;} = "";
    string cedula = "", nombre = "", apellido = "", telefono = "", correo = "",
        fecha_nacimiento = "", tipo_sangre = "", provincia = "", direccion = "", lat = "", lon = "", covid = "";

    int mensaje = 0, mensaje_error = 0, mensaje_vacio = 0;
    string justificacion = "";
    string correo_verificado;
    string recibido="Saludos,<br> Muchas gracias por registrarte en la jornardada de Prevencion del Covid-19.";
    bool validar;

    public void AgregarVacuna()
    {
        using (db_a72461_backupContext contexto = new db_a72461_backupContext())
        {
            validar = contexto.Vacunas.Any(ee => ee.Cedula == cedula);

            if (validar)
            {
                Vacunas va = contexto.Vacunas
                        .Where(e => e.Cedula == cedula)
                        .FirstOrDefault();

                correo_verificado = va.Correo;
                mensaje = 0;
                mensaje_vacio = 0;
                mensaje_error = 1;
            }

            else
            {
                Vacunas vacu = new Vacunas();
                vacu.Cedula = cedula;
                vacu.Nombre = nombre;
                vacu.Apellido = apellido;
                vacu.Telefono = telefono;
                vacu.Correo = correo;
                vacu.FechaNacimiento = fecha_nacimiento;
                vacu.TipoSangre = tipo_sangre;
                vacu.Provincia = provincia;
                vacu.Direccion = direccion;
                vacu.Latitud = lat;
                vacu.Longitud = lon;
                vacu.Covid = covid;
                vacu.Justifique = justificacion;

                if (vacu.Cedula == "" || vacu.Nombre == "" || vacu.Apellido == "" || vacu.Telefono == "" || vacu.Correo == "" ||
                    vacu.FechaNacimiento == "" || vacu.TipoSangre == "" || vacu.Provincia == "" || vacu.Direccion == "" || vacu.Latitud == "" ||
                    vacu.Longitud == "" || vacu.Covid == "" || vacu.Justifique == "")
                {
                    mensaje = 0;
                    mensaje_error = 0;
                    mensaje_vacio = 1;
                }

                else
                {
                    if(IsValidEmail(vacu.Correo)){
                        contexto.Add(vacu);
                        contexto.SaveChanges();
                        mensaje_error = 0;
                        mensaje_vacio = 0;
                        mensaje = 1;

                        SenMail(vacu.Correo,recibido);


                    

                       cedula = "";
                       apellido = "";
                       telefono = "";
                       correo = "";
                       fecha_nacimiento = "";
                       tipo_sangre = "";
                       provincia = "";
                       direccion = "";
                       lat = "";
                       lon = "";
                       covid = "";
                       justificacion = "";
                    }else{
                            mensaje_vacio = 15;
                    }
                    
                }
            }

        }
    }


    

#line default
#line hidden
#nullable disable
#nullable restore
#line 170 "C:\Users\dhima\Tarea-9\Tarea-9\Pages\Index.razor"
                                                      
    public static bool IsValidEmail(string strMailAddress)
        {
        // Return true if strIn is in valid e-mail format.
        return Regex.IsMatch(strMailAddress, @"^(?("")("".+?""@)|(([0-9a-zA-Z]((\.(?!\.))|[-!#\$%&'\*\+/=\?\^`\{\}\|~\w])*)(?<=[0-9a-zA-Z])@))" + @"(?(\[)(\[(\d{1,3}\.){3}\d{1,3}\])|(([0-9a-zA-Z][-\w]*[0-9a-zA-Z]\.)+[a-zA-Z]{2,6}))$");
    }

    

#line default
#line hidden
#nullable disable
#nullable restore
#line 177 "C:\Users\dhima\Tarea-9\Tarea-9\Pages\Index.razor"
                                  
    private void SenMail(String enviar1,String mensajeEnviar){
        try{
            using(MailMessage mail = new MailMessage()){
                mail.From = new MailAddress("calkin440040@gmail.com");
                mail.To.Add(enviar1);
                mail.Subject = "Registro de Vacuna por Casa.";
                mail.Body = (mensajeEnviar);
                mail.IsBodyHtml = true;

                using (SmtpClient smtp = new SmtpClient("smtp.gmail.com",587)){
                    smtp.Credentials = new System.Net.NetworkCredential("calkin440040@gmail.com","And440040");
                    smtp.EnableSsl = true;
                    smtp.Send(mail);
                    Menssage = "Mail Sent";
                    
                }
            }
            
        }catch(Exception ex){
            Menssage = ex.Message;
        }
    }


#line default
#line hidden
#nullable disable
    }
}
#pragma warning restore 1591
